---
name: Fix hardcoded log directory path and startup race condition
status: open
created: 2025-09-20T16:21:48Z
updated: 2025-09-20T18:22:04Z
github: https://github.com/pupiltree/centuryproptax/issues/21
depends_on: []
parallel: true
conflicts_with: [22]
---

# Task: Fix hardcoded log directory path and startup race condition

## Description
Replace hardcoded `logs/app.log` path in `src/main.py` with configurable environment variable and move log directory creation to FastAPI startup event handler to prevent race conditions.

## Acceptance Criteria
- [ ] Remove hardcoded `logs/app.log` path from main.py:20
- [ ] Add `LOG_DIR` environment variable with fallback to system temp directory
- [ ] Move log directory creation from `__main__` block to FastAPI startup event
- [ ] Application starts successfully even when log directory cannot be created
- [ ] Graceful fallback to console-only logging when file logging fails

## Technical Details
- **Files affected**: `src/main.py`
- **Current issue**: Log directory only created during `__main__` execution (line 205)
- **Fix approach**: Use FastAPI `@app.on_event("startup")` to ensure directory creation during all startup scenarios
- **Environment variable**: `LOG_DIR` with fallback to `tempfile.gettempdir()`
- **Error handling**: Catch filesystem exceptions and continue with console logging

## Dependencies
- [ ] No external dependencies - uses existing FastAPI patterns

## Effort Estimate
- **Size**: S
- **Hours**: 4-6 hours
- **Parallel**: true (independent infrastructure change)

## Definition of Done
- [ ] Code implemented with environment variable support
- [ ] Startup event handler ensures log directory creation
- [ ] Tests verify behavior when log directory unavailable
- [ ] Application starts reliably in all deployment environments
- [ ] No deployment failures due to logging configuration
