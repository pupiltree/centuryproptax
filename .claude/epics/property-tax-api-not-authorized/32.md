---
name: Environment Configuration - Implement API mode switching system
status: completed
created: 2025-09-21T20:37:02Z
github: https://github.com/pupiltree/centuryproptax/issues/32
depends_on: []
parallel: true
last_sync: 2025-09-22T08:56:54Z
conflicts_with: []
---

# Task: Environment Configuration - Implement API mode switching system

## Description

Implement a comprehensive environment configuration system that enables seamless switching between mock and production property tax APIs without code changes. This system will provide controlled demo environments and enable development workflows while maintaining the option to integrate real government APIs when authorized.

## Acceptance Criteria

- [ ] Environment variable system for API mode switching (`PROPERTY_TAX_API_MODE`)
- [ ] Configuration management module for centralized API settings
- [ ] Integration with existing environment configuration structure
- [ ] Mock data scenario configuration (`MOCK_DATA_SCENARIO`)
- [ ] API endpoint routing based on configuration mode
- [ ] Validation and fallback mechanisms for configuration errors
- [ ] Documentation for configuration options and usage

## Technical Details

### Configuration Variables:

1. **Primary Mode Control**
   - `PROPERTY_TAX_API_MODE`: "mock" | "production" | "hybrid"
   - Controls which API endpoints are used for property tax operations
   - Default: "mock" for development, configurable for production

2. **Mock Data Scenarios**
   - `MOCK_DATA_SCENARIO`: "basic" | "comprehensive" | "demo" | "test"
   - Controls the type and complexity of generated mock data
   - Enables different demo presentations and testing scenarios

3. **API Configuration**
   - `MOCK_API_BASE_URL`: Base URL for mock API endpoints
   - `PRODUCTION_API_BASE_URL`: Base URL for government API endpoints
   - `API_TIMEOUT_SECONDS`: Request timeout configuration
   - `API_RETRY_ATTEMPTS`: Retry logic configuration

### Implementation Components:

**Configuration Module** (`config/api_settings.py`)
- Centralized configuration loading and validation
- Environment variable parsing with type safety
- Default value management and fallback logic
- Integration with existing settings.py structure

**API Router Service** (`services/api_router.py`)
- Dynamic endpoint routing based on configuration mode
- Request routing logic for mock vs production APIs
- Error handling and fallback mechanisms
- Consistent interface regardless of backend mode

**Environment Integration**
- Update existing `.env` file with new configuration variables
- Integration with current environment loading patterns
- Configuration validation on application startup
- Environment-specific defaults (development vs production)

### Configuration Modes:

1. **Mock Mode** (`PROPERTY_TAX_API_MODE=mock`)
   - All property tax requests routed to mock endpoints
   - Uses generated data for all responses
   - Ideal for demos, development, and testing

2. **Production Mode** (`PROPERTY_TAX_API_MODE=production`)
   - All requests routed to government APIs
   - Requires proper API authorization and credentials
   - Production deployment configuration

3. **Hybrid Mode** (`PROPERTY_TAX_API_MODE=hybrid`)
   - Fallback from production to mock on authorization failures
   - Enables graceful degradation during API outages
   - Advanced configuration for partial government API access

## Implementation Steps

1. **Environment Variable Definition**
   - Add new configuration variables to `.env.example`
   - Update existing `.env` files with default values
   - Document configuration options and valid values

2. **Configuration Module Creation**
   - Create `config/api_settings.py` with configuration loading
   - Implement validation and type checking for all settings
   - Add integration with existing settings management

3. **API Router Implementation**
   - Create `services/api_router.py` for dynamic routing
   - Implement mode-based endpoint selection logic
   - Add error handling and fallback mechanisms

4. **Integration with Application**
   - Update application startup to load and validate configuration
   - Integrate router service with existing API patterns
   - Update existing property tax API calls to use router

5. **Testing and Validation**
   - Test configuration loading and validation
   - Verify mode switching functionality
   - Validate fallback and error handling scenarios

## Dependencies

**Prerequisites:**
- Existing environment configuration system (`.env`, `settings.py`)
- Current FastAPI application structure
- Understanding of existing API patterns and usage

**Integration Points:**
- Mock API infrastructure (Task 31) for endpoint routing
- Existing environment variable management
- Current application startup and configuration loading

**Concurrent Development:**
- Can proceed in parallel with mock API infrastructure (Task 31)
- Enables data models and schemas configuration (Task 33)

## Effort Estimate

**Total Time:** 6-8 hours

**Breakdown:**
- Environment variable setup and documentation: 1-2 hours
- Configuration module implementation: 2-3 hours
- API router service development: 2-3 hours
- Integration and testing: 1-2 hours

**Critical Path:** This task enables seamless switching between mock and production modes for all subsequent development.

## Success Criteria

**Quality Gates:**
- Configuration loads correctly in all environments
- Mode switching works without application restart
- Error handling gracefully manages invalid configurations
- Integration preserves existing application functionality

**Deliverables:**
- Complete environment configuration system
- API router service for dynamic endpoint selection
- Updated environment files with new configuration options
- Configuration validation and error handling
- Documentation for all configuration options

**Validation:**
- All configuration modes function correctly
- Environment variable validation catches errors on startup
- Mode switching works seamlessly without code changes
- Fallback mechanisms handle configuration errors gracefully
- Integration maintains existing API functionality
