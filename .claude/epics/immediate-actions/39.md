---
name: Legacy Code Audit & Cleanup - Eliminate simplified_agent_v2.py compatibility layer
status: backlog
created: 2025-09-22T16:10:00Z
github: https://github.com/pupiltree/centuryproptax/issues/40
depends_on: []
parallel: false
last_sync: 2025-09-22T18:50:15Z
conflicts_with: []
---

# Task: Legacy Code Audit & Cleanup - Eliminate simplified_agent_v2.py compatibility layer

## Description

Conduct comprehensive audit and systematic cleanup of the `simplified_agent_v2.py` compatibility layer to eliminate technical debt and simplify the agent architecture. This task will create a clean migration path from legacy agent implementation to the primary `property_tax_assistant_v3.py` while maintaining 100% backward compatibility during the transition period.

## Acceptance Criteria

- [ ] Complete audit of all `simplified_agent_v2.py` references across the codebase
- [ ] Document migration strategy with compatibility bridge implementation
- [ ] Update all import statements to use primary agent implementation
- [ ] Create temporary compatibility shim for smooth transition
- [ ] Verify all functionality remains intact post-cleanup
- [ ] Remove or properly deprecate legacy compatibility layer
- [ ] Update documentation to reflect clean agent architecture
- [ ] Comprehensive testing to ensure zero behavioral changes

## Technical Details

### Implementation Scope:
- **Audit Phase**: Scan entire codebase for `simplified_agent_v2.py` usage
- **Compatibility Bridge**: Create temporary import shim maintaining backward compatibility
- **Migration Strategy**: Systematic update of import statements and references
- **Verification Layer**: Comprehensive testing ensuring no functionality changes
- **Documentation Update**: Clean architectural documentation reflecting changes

### Core Components:

1. **Codebase Audit**
   - Search all Python files for `simplified_agent_v2` references
   - Document all import statements and usage patterns
   - Identify critical dependencies and integration points
   - Create comprehensive migration checklist

2. **Compatibility Bridge Design**
   - Create import shim in `simplified_agent_v2.py` that delegates to v3
   - Ensure method signature compatibility
   - Maintain response format consistency
   - Add deprecation warnings for development visibility

3. **Systematic Migration**
   - Update import statements file by file
   - Replace direct instantiation calls
   - Update configuration references
   - Modify test files to use primary implementation

4. **Verification Testing**
   - Run full test suite after each migration step
   - Verify WhatsApp integration functionality
   - Test all API endpoints using agent services
   - Validate response consistency across all flows

### Migration Strategy:
- **Phase 1**: Create compatibility bridge and validate existing functionality
- **Phase 2**: Update non-critical file imports systematically
- **Phase 3**: Migrate critical integration points with extensive testing
- **Phase 4**: Remove legacy references and clean up deprecation warnings

### Risk Mitigation:
- Maintain original `simplified_agent_v2.py` as backup during transition
- Implement rollback capability at each migration step
- Comprehensive testing before and after each change
- Gradual migration with immediate rollback if issues detected

## Implementation Steps

1. **Comprehensive Codebase Audit**
   - Use grep/ripgrep to find all `simplified_agent_v2` references
   - Document file locations, line numbers, and usage context
   - Identify import patterns and instantiation methods
   - Create prioritized migration order (low-risk to high-risk)

2. **Compatibility Bridge Implementation**
   - Modify `simplified_agent_v2.py` to import and delegate to v3
   - Ensure all public methods maintain identical signatures
   - Add deprecation warnings with migration guidance
   - Test compatibility bridge with existing functionality

3. **Systematic Import Migration**
   - Start with lowest-risk files (utilities, non-critical modules)
   - Update import statements to use `property_tax_assistant_v3`
   - Test functionality after each file migration
   - Document any compatibility issues discovered

4. **Critical Integration Migration**
   - Migrate WhatsApp integration files with extensive testing
   - Update API endpoint handlers using agent services
   - Modify configuration files and service initialization
   - Validate all agent-dependent functionality

5. **Legacy Cleanup and Documentation**
   - Remove compatibility bridge after successful migration
   - Update architectural documentation
   - Clean up any remaining deprecation warnings
   - Update developer onboarding guides

## Dependencies

**Prerequisites:**
- Stable production environment for safe testing
- Complete understanding of `property_tax_assistant_v3.py` capabilities
- Access to comprehensive test suite for validation

**Integration Points:**
- WhatsApp service integration (`src/integrations/whatsapp/`)
- API endpoint handlers (`src/api/`)
- Agent service configuration (`src/core/`)
- Test files using agent functionality

**Concurrent Development:**
- Can proceed in parallel with documentation generation tasks
- Must coordinate with monitoring implementation to avoid conflicts

## Effort Estimate

**Total Time:** 12-16 hours

**Breakdown:**
- Codebase audit and documentation: 3-4 hours
- Compatibility bridge implementation: 2-3 hours
- Systematic import migration: 4-6 hours
- Testing and validation: 2-3 hours
- Cleanup and documentation update: 1-2 hours

**Critical Path:** Must complete before documentation portal deployment to ensure clean architecture documentation.

## Success Criteria

**Quality Gates:**
- Zero functionality changes or behavioral regressions
- All tests pass with primary agent implementation
- Clean import structure with no legacy references
- Comprehensive documentation reflecting new architecture

**Deliverables:**
- Clean codebase with unified agent architecture
- Migration documentation for future reference
- Updated architectural documentation
- Comprehensive test validation confirming no regressions

**Validation:**
- All WhatsApp integration flows work identically
- API endpoints maintain response consistency
- Performance characteristics remain unchanged
- Developer onboarding improved through simplified architecture