---
name: Dependency Analysis and Usage Mapping
status: completed
created: 2025-09-19T12:15:02Z
updated: 2025-09-19T13:49:56Z
github: https://github.com/pupiltree/centuryproptax/issues/12
depends_on: []
parallel: false
conflicts_with: []
---

# Task: Dependency Analysis and Usage Mapping

## Description

Create a comprehensive dependency analysis and usage mapping of the entire codebase to identify components with zero usage in property tax workflows. This foundational analysis will guide safe removal decisions and prevent accidental deletion of required components.

## Acceptance Criteria

- [ ] Complete import graph mapping for all Python modules and packages
- [ ] Usage frequency analysis for all services and utilities
- [ ] Zero-usage identification for voice, image analysis, and Instagram services
- [ ] Dependency chain analysis showing what imports what
- [ ] Safety assessment report indicating removable vs critical components
- [ ] Package dependency audit showing unused external dependencies
- [ ] Generated removal roadmap with risk assessment for each component

## Technical Details

### Analysis Scope:
- **Python Modules**: Map all import statements across `/services/`, `/agents/`, `/src/`, `/scripts/`
- **External Packages**: Analyze `requirements.txt` against actual import usage
- **Configuration Files**: Identify unused environment variables and config sections
- **Service Dependencies**: Map inter-service communication and dependencies
- **Docker Components**: Identify unused container configurations

### Tools and Methods:
- Static analysis using Python AST parsing to track imports
- Grep-based search for usage patterns across the codebase
- Package dependency analysis using pip tools
- Configuration file parsing for unused variables
- Docker and docker-compose analysis for service dependencies

### Expected Outputs:
1. **Import Map Report**: Complete graph of what imports what
2. **Zero Usage Report**: List of components with no references
3. **Risk Assessment**: Components safe to remove vs those requiring careful evaluation
4. **Package Cleanup List**: External dependencies that can be removed
5. **Removal Roadmap**: Ordered list of removal operations with dependencies

### Key Areas to Analyze:
- `/services/voice/` - Voice processing services (expected zero usage)
- `/services/image_analysis/` - Computer vision and OCR services (expected zero usage)
- Instagram-related code across messaging and communication services
- Medical domain remnants from Krishna Diagnostics origin
- Advanced analytics and dashboard components marked as "future consideration"

### Safety Checks:
- Preserve LangGraph two-node workflow (Assistant â†’ Tools)
- Maintain WhatsApp Business API integration
- Protect property tax domain tools (6 tools developed for chatbot)
- Preserve database and Redis persistence layers
- Keep FastAPI web framework and core endpoints

## Implementation Steps

1. **Static Import Analysis**
   - Use Python AST to parse all .py files
   - Generate complete import dependency graph
   - Identify circular dependencies and import conflicts

2. **Usage Pattern Mapping**
   - Search for function and class usage across codebase
   - Map service-to-service communication patterns
   - Identify dead code and unused functions

3. **Package Dependency Audit**
   - Compare requirements.txt against actual imports
   - Identify packages only used by services scheduled for removal
   - Generate safe-to-remove package list

4. **Configuration Analysis**
   - Parse environment files for unused variables
   - Identify service-specific configurations that can be removed
   - Map configuration dependencies

5. **Risk Assessment Generation**
   - Categorize components by removal risk (safe, caution, critical)
   - Document dependencies that would break with removal
   - Create rollback procedures for each removal operation

## Dependencies

**Prerequisites:**
- Access to complete codebase for static analysis
- Python AST parsing tools for import analysis
- Grep and search tools for usage pattern identification

**Downstream Tasks:**
- All service removal tasks (002, 003, 004) depend on this analysis
- Package cleanup operations require dependency audit results
- Configuration cleanup needs unused variable identification

## Effort Estimate

**Total Time:** 6-8 hours (Day 1 of epic)

**Breakdown:**
- Static analysis setup and execution: 2 hours
- Usage pattern mapping and verification: 2-3 hours
- Risk assessment and safety validation: 2 hours
- Report generation and documentation: 1-2 hours

**Critical Path:** This task blocks all removal operations and must complete before any deletion activities begin.

## Success Criteria

**Quality Gates:**
- Zero false positives in zero-usage identification
- Complete dependency chain mapping with no missing links
- Risk assessment covers all components scheduled for removal
- Generated roadmap provides clear, safe removal sequence

**Deliverables:**
- Comprehensive dependency analysis report
- Zero-usage component identification with confidence scores
- Risk-categorized removal roadmap
- Package dependency cleanup recommendations
- Rollback procedures for each planned removal operation

**Validation:**
- Manual verification of zero-usage claims for high-risk components
- Cross-reference analysis results against known property tax workflow requirements
- Safety assessment reviewed against preservation requirements